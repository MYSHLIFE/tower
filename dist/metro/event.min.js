((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Metro.Event=function(){function a(a,b){this.base=a,this.key=b,this.handlers=[],this._preventCount=0}return b(a,Metro.Object),a.include({ClassMethods:{"for":function(a,b){return a.isEventEmitter?a.event(b):new Metro.Event(a,b)}},isEvent:!0,addHandler:function(a){return this.handlers.push(a),this.oneShot&&this.autofireHandler(a),this},removeHandler:function(a){return this.handlers.splice(1,this.handlers.indexOf(a)),this},handlerContext:function(){return this.base},prevent:function(){return++this._preventCount},allow:function(){return this._preventCount&&--this._preventCount,this._preventCount},isPrevented:function(){return this._preventCount>0},autofireHandler:function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},resetOneShot:function(){return this._oneShotFired=!1,this._oneShotArgs=null},fire:function(){var a,b,c,d,e,f,g;if(this.isPrevented()||this._oneShotFired)return!1;b=this.handlerContext(),a=arguments,d=this.handlers,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments),g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c.apply(b,a));return g},allowAndFire:function(){return this.allow(),this.fire.apply(this,arguments)}}),a}()})).call(this)