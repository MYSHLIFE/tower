((function(){var a=Array.prototype.slice;Metro.Route=function(){function a(a){a||(a=a),this.path=a.path,this.name=a.name,this.method=a.method,this.ip=a.ip,this.defaults=a.defaults||{},this.constraints=a.constraints,this.options=a,this.controller=a.controller,this.keys=[],this.pattern=this.extractPattern(this.path),this.id=this.path,this.controller&&(this.id+=this.controller.name+this.controller.action)}return a.include(Metro.Model.Scopes),a.store=function(){return this._store||(this._store=new Metro.Store.Memory)},a.create=function(a){return this.store().create(a)},a.normalizePath=function(a){return"/"+a.replace(/^\/|\/$/,"")},a.initialize=function(){return require(""+Metro.root+"/config/routes")},a.teardown=function(){return this.store().clear(),delete require.cache[require.resolve(""+Metro.root+"/config/routes")],delete this._store},a.reload=function(){return this.teardown(),this.initialize()},a.draw=function(a){return a.apply(new Metro.Route.DSL(this)),this},a.prototype.match=function(a){return this.pattern.exec(a)},a.prototype.extractPattern=function(a,b,c){var d,e;return a instanceof RegExp?a:(d=this,a==="/"?new RegExp("^"+a+"$"):(a=a.replace(/(\(?)(\/)?(\.)?([:\*])(\w+)(\))?(\?)?/g,function(a,b,c,e,f,g,h,i){var j,k;i=!!i||b+h==="()",k=f==="*",d.keys.push({name:g,optional:!!i,splat:k}),c||(c=""),j="";if(!i||!k)j+=c;return j+="(?:",e!=null?j+=k?"\\.([^.]+?)":"\\.([^/.]+?)":j+=k?"/?(.+)":"([^/\\.]+)",j+=")",i&&(j+="?"),j}),new RegExp("^"+a+"$",(e=!!b)!=null?e:{"":"i"})))},a}(),Metro.Route.DSL=function(){function b(){}return b.prototype.match=function(){return this.scope||(this.scope={}),Metro.Route.create(new Metro.Route(this._extractOptions.apply(this,arguments)))},b.prototype.get=function(){return this.matchMethod.apply(this,["get"].concat(a.call(arguments)))},b.prototype.post=function(){return this.matchMethod.apply(this,["post"].concat(a.call(arguments)))},b.prototype.put=function(){return this.matchMethod.apply(this,["put"].concat(a.call(arguments)))},b.prototype["delete"]=function(){return this.matchMethod.apply(this,["delete"].concat(a.call(arguments)))},b.prototype.matchMethod=function(a){var b;return b=arguments.pop(),b.via=a,arguments.push(b),this.match(b),this},b.prototype.scope=function(){},b.prototype.controller=function(a,b,c){return b.controller=a,this.scope(b,c)},b.prototype.namespace=function(a,b,c){return b=_.extend({path:a,as:a,module:a,shallowPath:a,shallowPrefix:a},b),this.scope(b,c)},b.prototype.constraints=function(a,b){return this.scope({constraints:a},b)},b.prototype.defaults=function(a,b){return this.scope({defaults:a},b)},b.prototype.resource=function(){},b.prototype.resources=function(){},b.prototype.collection=function(){},b.prototype.member=function(){},b.prototype.root=function(a){return this.match("/",_.extend({as:"root"},a))},b.prototype._extractOptions=function(){var a,b,c,d,e,f,g,h,i;return i=Metro.Route.normalizePath(arguments[0]),h=arguments[arguments.length-1]||{},h.path=i,e=this._extractFormat(h),h.path=this._extractPath(h),f=this._extractRequestMethod(h),b=this._extractConstraints(h),d=this._extractDefaults(h),c=this._extractController(h),a=this._extractAnchor(h),g=this._extractName(h),h=_.extend(h,{method:f,constraints:b,defaults:d,name:g,format:e,controller:c,anchor:a,ip:h.ip}),h},b.prototype._extractFormat=function(a){},b.prototype._extractName=function(a){return a.as},b.prototype._extractConstraints=function(a){return a.constraints||{}},b.prototype._extractDefaults=function(a){return a.defaults||{}},b.prototype._extractPath=function(a){return""+a.path+".:format?"},b.prototype._extractRequestMethod=function(a){return a.via||a.requestMethod},b.prototype._extractAnchor=function(a){return a.anchor},b.prototype._extractController=function(a){var b,c,d;return d=a.to.split("#"),d.length===1?b=d[0]:(c=d[0],b=d[1]),c||(c=a.controller||this.scope.controller),b||(b=a.action||this.scope.action),c=c.toLowerCase().replace(/(?:Controller)?$/,"Controller"),b=b.toLowerCase(),{name:c,action:b,className:_.camelize("_"+c)}},b}()})).call(this)