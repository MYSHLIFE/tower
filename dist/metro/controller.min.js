((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Metro.Controller=function(){function a(){this.headers={},this.status=200,this.request=null,this.response=null,this.contentType="text/html",this.params={},this.query={}}return b(a,Metro.Object),a}(),Metro.Controller.Callbacks={ClassMethods:{filters:function(){return this._filters||(this._filters={before:[],after:[]})},beforeFilter:function(){var a;return a=Metro.Support.Array.args(arguments),this.filters().before.push({method:a.shift(),options:a.shift()}),this},afterFilter:function(){}},runFilters:function(a,b){var c,d,e,f;return f=this,d=this.constructor.filters().before,c=this.constructor.filters().after,e=function(a,b){var c,d;c=a.method;if(typeof c=="string"){if(!f[c])throw new Error("Method '"+c+"' not defined on "+f.constructor.name);c=f[c]}switch(c.length){case 0:d=c.call(f);if(!d)return b(new Error("did not pass filter"));return b();default:return c.call(f,function(a,c){return a?b(a):c?b():b(new Error("did not pass filter"))})}},require("async").forEachSeries(d,e,function(c){return c?b(c):a.call(f)})}},Metro.Controller.Helpers={ClassMethods:{helper:function(a){return this._helpers||(this._helpers=[]),this._helpers.push(a)}},urlFor:function(){}},Metro.Controller.HTTP={},Metro.Controller.Layouts={ClassMethods:{layout:function(a){return this._layout=a},theme:function(a){return this._theme=a}},layout:function(){var a;return a=this.constructor._layout,typeof a=="function"?a.apply(this):a}},Metro.Controller.Params={ClassMethods:{params:function(a,b){return typeof a=="function"&&(b=a,a={}),a&&(this._paramsOptions=Metro.Support.Object.extend(this._paramsOptions||{},a),b.call(this)),this._params||(this._params={})},param:function(a,b){return b==null&&(b={}),this._params||(this._params={}),this._params[a]=Metro.Net.Param.create(a,Metro.Support.Object.extend({},this._paramsOptions||{},b))}},criteria:function(){var a,b,c,d,e;if(this._criteria)return this._criteria;this._criteria=a=new Metro.Model.Criteria,e=this.constructor.params(),c=this.params;for(b in e)d=e[b],c.hasOwnProperty(b)&&a.where(d.toCriteria(c[b]));return a},withParams:function(a,b){var c,d;return b==null&&(b={}),c=Metro.Support.Object.extend(this.query,b),Metro.Support.Object.blank(c)?a:(d=this.queryFor(c),""+a+"?"+query_string)},queryFor:function(a){a==null&&(a={})},paramOperators:function(a){}},Metro.Controller.Processing={call:function(a,b,c){return this.request=a,this.response=b,this.params=this.request.params||{},this.cookies=this.request.cookies||{},this.query=this.request.query||{},this.session=this.request.session||{},this.format=this.params.format,this.headers={},this.callback=c,this.format&&this.format!=="undefined"?this.contentType=Metro.Support.Path.contentType(this.format):this.contentType="text/html",this.process()},process:function(){var a,b=this;return this.processQuery(),a=function(a){return b[b.params.action].call(b,a)},this.runFilters(a,function(a){return console.log("ERROR in callback!"),console.log(a)})},processQuery:function(){},clear:function(){return this.request=null,this.response=null,this.headers=null}},Metro.Controller.Redirecting={redirectTo:function(){}},Metro.Controller.Rendering={render:function(){var a,b,c,d,e,f;return a=Metro.Support.Array.args(arguments),a.length>=2&&typeof a[a.length-1]=="function"?b=a.pop():b=null,a.length>1&&typeof a[a.length-1]=="object"&&(c=a.pop()),typeof a[0]=="object"?c=a[0]:(c||(c={}),c.template=a[0]),e=new Metro.View(this),(f=this.headers)["Content-Type"]||(f["Content-Type"]=this.contentType),d=this,e.render.call(e,c,function(a,c){a?d.body=a.stack:d.body=c,b&&b(a,c);if(d.callback)return d.callback()})},renderToBody:function(a){return this._processOptions(a),this._renderTemplate(a)},renderToString:function(){var a;return a=this._normalizeRender.apply(this,arguments),this.renderToBody(a)},_renderTemplate:function(a){return this.template.render(viewContext,a)}},Metro.Controller.Resources={ClassMethods:{resource:function(a){return a&&(this._resource=a),this._resource}},_create:function(a){},resource:function(){},collection:function(){},resourceClass:function(){},buildResource:function(){},createResource:function(){},updateResource:function(){},destroyResource:function(){},parent:function(){},endOfAssociationChain:function(){},associationChain:function(){}},Metro.Controller.Responding={ClassMethods:{respondTo:function(){return this._respondTo||(this._respondTo=[]),this._respondTo=this._respondTo.concat(Metro.Support.Array.args(arguments))}},respondWith:function(){var a,b;b=arguments[0],arguments.length>1&&typeof arguments[arguments.length-1]=="function"&&(a=arguments[arguments.length-1]);switch(this.format){case"json":return this.render({json:b});case"xml":return this.render({xml:b});default:return this.render({action:this.action})}}},Metro.Controller.Sockets={broadcast:function(){},emit:function(){}},Metro.Controller.include(Metro.Controller.Callbacks),Metro.Controller.include(Metro.Controller.Helpers),Metro.Controller.include(Metro.Controller.HTTP),Metro.Controller.include(Metro.Controller.Layouts),Metro.Controller.include(Metro.Controller.Params),Metro.Controller.include(Metro.Controller.Processing),Metro.Controller.include(Metro.Controller.Redirecting),Metro.Controller.include(Metro.Controller.Rendering),Metro.Controller.include(Metro.Controller.Resources),Metro.Controller.include(Metro.Controller.Responding),Metro.Controller.include(Metro.Controller.Sockets)})).call(this)