((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Metro.Controller=function(){function a(){this.headers={},this.status=200,this.request=null,this.response=null,this.contentType="text/html",this.params={},this.query={}}return b(a,Metro.Object),a}(),Metro.Controller.Caching={},Metro.Controller.Helpers={ClassMethods:{helper:function(a){return this._helpers||(this._helpers=[]),this._helpers.push(a)}},urlFor:function(){}},Metro.Controller.HTTP={},Metro.Controller.Layouts({ClassMethods:{layout:function(a){return this._layout=a},theme:function(a){return this._theme=a}},layout:function(){var a;return a=this.constructor._layout,typeof a=="function"?a.apply(this):a}}),Metro.Controller.Redirecting={redirectTo:function(){}},Metro.Controller.Rendering={render:function(){var a,b,c,d,e,f;return a=Metro.Support.Array.args(arguments),a.length>=2&&typeof a[a.length-1]=="function"&&(b=a.pop()),e=new Metro.View(this),(f=this.headers)["Content-Type"]||(f["Content-Type"]=this.contentType),d=this,a.push(c=function(a,c){return a?d.body=a.stack:d.body=c,b&&b(a,c),d.callback()}),e.render.apply(e,a)},renderToBody:function(a){return this._processOptions(a),this._renderTemplate(a)},renderToString:function(){var a;return a=this._normalizeRender.apply(this,arguments),this.renderToBody(a)},_renderTemplate:function(a){return this.template.render(viewContext,a)}},Metro.Controller.Responding={ClassMethods:{respondTo:function(){return this._respondTo||(this._respondTo=[]),this._respondTo=this._respondTo.concat(Metro.Support.Array.args(arguments))}},respondWith:function(){var a,b;b=arguments[0],arguments.length>1&&typeof arguments[arguments.length-1]=="function"&&(a=arguments[arguments.length-1]);switch(this.format){case"json":return this.render({json:b});case"xml":return this.render({xml:b});default:return this.render({action:this.action})}},call:function(a,b,c){return this.request=a,this.response=b,this.params=this.request.params||{},this.cookies=this.request.cookies||{},this.query=this.request.query||{},this.session=this.request.session||{},this.format=this.params.format,this.headers={},this.callback=c,this.format&&this.format!=="undefined"?this.contentType=Metro.Support.Path.contentType(this.format):this.contentType="text/html",this.process()},process:function(){return this.processQuery(),this[this.params.action]()},processQuery:function(){},clear:function(){return this.request=null,this.response=null,this.headers=null}},Metro.Controller.include(Metro.Controller.Caching),Metro.Controller.include(Metro.Controller.Helpers),Metro.Controller.include(Metro.Controller.HTTP),Metro.Controller.include(Metro.Controller.Layouts),Metro.Controller.include(Metro.Controller.Redirecting),Metro.Controller.include(Metro.Controller.Rendering),Metro.Controller.include(Metro.Controller.Responding)})).call(this)