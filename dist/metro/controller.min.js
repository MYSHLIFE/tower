Metro.Controller=function(){function a(){a.__super__.constructor.apply(this,arguments)}return a.initialize=function(){return Metro.Support.Dependencies.load(""+Metro.root+"/app/controllers")},a.teardown=function(){return delete this._helpers,delete this._layout,delete this._theme},a.reload=function(){return this.teardown(),this.initialize()},a.helper=function(a){return this._helpers||(this._helpers=[]),this._helpers.push(a)},a.layout=function(a){return this._layout=a},a.theme=function(a){return this._theme=a},a.prototype.layout=function(){var a;return a=this.constructor._layout,typeof a=="function"?a.apply(this):a},a.getter("controllerName",a,function(){return Metro.Support.String.camelize(this.name)}),a.getter("controllerName",a.prototype,function(){return this.constructor.controllerName}),a.prototype.clear=function(){return this.request=null,this.response=null,this.headers=null},a}(),Metro.Controller.Flash=function(){function a(){a.__super__.constructor.apply(this,arguments)}return a}(),Metro.Controller.Redirecting=function(){function a(){}return a.prototype.redirectTo=function(){},a}(),Metro.Controller.Rendering=function(){function a(){a.__super__.constructor.apply(this,arguments)}return a.prototype.render=function(){var a,b,c,d,e,f;return a=Array.prototype.slice.call(arguments,0,arguments.length),a.length>=2&&typeof a[a.length-1]=="function"&&(b=a.pop()),e=new Metro.View(this),(f=this.headers)["Content-Type"]||(f["Content-Type"]=this.contentType),d=this,a.push(c=function(a,c){return a?d.body=a.stack:d.body=c,b&&b(a,c),d.callback()}),e.render.apply(e,a)},a.prototype.renderToBody=function(a){return this._processOptions(a),this._renderTemplate(a)},a.prototype.renderToString=function(){var a;return a=this._normalizeRender.apply(this,arguments),this.renderToBody(a)},a.prototype._renderTemplate=function(a){return this.template.render(viewContext,a)},a}(),Metro.Controller.Responding=function(){function a(){this.headers={},this.status=200,this.request=null,this.response=null,this.contentType="text/html",this.params={},this.query={}}return a.respondTo=function(){return this._respondTo||(this._respondTo=[]),this._respondTo=this._respondTo.concat(arguments)},a.prototype.respondWith=function(){var a,b;b=arguments[0],arguments.length>1&&typeof arguments[arguments.length-1]=="function"&&(a=arguments[arguments.length-1]);switch(this.format){case"json":return this.render({json:b});case"xml":return this.render({xml:b});default:return this.render({action:this.action})}},a.prototype.call=function(a,b,c){return this.request=a,this.response=b,this.params=this.request.params||{},this.cookies=this.request.cookies||{},this.query=this.request.query||{},this.session=this.request.session||{},this.format=this.params.format,this.headers={},this.callback=c,this.format&&this.format!=="undefined"?this.contentType=Metro.Support.Path.contentType(this.format):this.contentType="text/html",this.process()},a.prototype.process=function(){return this.processQuery(),this[this.params.action]()},a.prototype.processQuery=function(){},a}(),Metro.Controller.include(Metro.Controller.Flash),Metro.Controller.include(Metro.Controller.Redirecting),Metro.Controller.include(Metro.Controller.Rendering),Metro.Controller.include(Metro.Controller.Responding)