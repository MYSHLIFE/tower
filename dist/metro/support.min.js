((function(){var a,b=Object.prototype.hasOwnProperty,c=Array.prototype.indexOf||function(a){for(var c=0,d=this.length;c<d;c++)if(b.call(this,c)&&this[c]===a)return c;return-1},d=Array.prototype.slice;Metro.Support={},Metro.Support.Array={args:function(a,b,c,d){b==null&&(b=0),c==null&&(c=!1),d==null&&(d=!1),a=Array.prototype.slice.call(a,b,a.length);if(!c||a.length>=2&&typeof a[a.length-1]=="function")return a;throw new Error("You must pass a callback to the render method")},sortBy:function(a){var b,c,d,e;return d=this.args(arguments,1),c=d[d.length-1]instanceof Array?{}:d.pop(),e=function(a,b){return a>b?1:a<b?-1:0},b=function(a,b){var f,g;return f=[],g=[],d.forEach(function(d){var h,i,j,k;return i=d[0],k=d[1],h=a[i],j=b[i],typeof c[i]!="undefined"&&(h=c[i](h),j=c[i](j)),f.push(k*e(h,j)),g.push(k*e(j,h))}),f<g?-1:1},d=d.map(function(a){return a instanceof Array||(a=[a,"asc"]),a[1]==="desc"?a[1]=-1:a[1]=1,a}),a.sort(function(a,c){return b(a,c)})}},a=["included","extended","prototype","ClassMethods","InstanceMethods"],Metro.Class=function(){function b(){this.initialize()}return b.alias=function(a,b){return Metro.Support.Object.alias(this.prototype,a,b)},b.accessor=function(a,b){return Metro.Support.Object.accessor(this.prototype,a,b),this},b.getter=function(a,b){return Metro.Support.Object.getter(this.prototype,a,b),this},b.setter=function(a){return Metro.Support.Object.setter(this.prototype,a),this},b.classAlias=function(a,b){return Metro.Support.Object.alias(this,a,b),this},b.classAccessor=function(a,b){return Metro.Support.Object.accessor(this,a,b),this},b.classGetter=function(a,b){return Metro.Support.Object.getter(this,a,b),this},b.classSetter=function(a){return Metro.Support.Object.setter(this,a),this},b.classEval=function(a){return a.call(this)},b.delegate=function(a,b){return b==null&&(b={}),Metro.Support.Object.delegate(this.prototype,a,b),this},b.mixin=function(b,d){var e,f;for(e in d)f=d[e],c.call(a,e)<0&&(b[e]=f);return d},b.extend=function(a){var b;return this.mixin(this,a),b=a.extended,b&&b.apply(a),a},b.include=function(a){var b;return a.hasOwnProperty("ClassMethods")&&this.extend(a.ClassMethods),a.hasOwnProperty("InstanceMethods")&&this.include(a.InstanceMethods),this.mixin(this.prototype,a),b=a.included,b&&b.apply(a),a},b.className=function(){return Metro.Support.Object.functionName(this)},b.prototype.className=function(){return this.constructor.className()},b.prototype.initialize=function(){},b}(),Metro.Support.EventEmitter={isEventEmitter:!0,events:function(){return this._events||(this._events={})},hasEventListener:function(a){return Metro.Support.Object.isPresent(this.events(),a)},event:function(a){var b;return(b=this.events())[a]||(b[a]=new Metro.Event(this,a))},on:function(a,b){return this.event(a).addHandler(b)},mutation:function(a){return function(){var b;return b=a.apply(this,arguments),this.event("change").fire(this,this),b}},prevent:function(a){return this.event(a).prevent(),this},allow:function(a){return this.event(a).allow(),this},isPrevented:function(a){return this.event(a).isPrevented()},fire:function(a){var b;return b=this.event(a),b.fire.call(b,Metro.Support.Array.args(arguments,1))},allowAndFire:function(a){return this.event(a).allowAndFire(Metro.Support.Array.args(arguments,1))}},Metro.Support.I18n={load:function(a,b){var c;return b==null&&(b=this.defaultLanguage),c=this.store(),b=c[b]||(c[b]={}),Metro.Support.Object.deepMerge(b,typeof a=="string"?require(a):a),this},defaultLanguage:"en",translate:function(a,b){b==null&&(b={}),b.hasOwnProperty("tense")&&(a+="."+b.tense);if(b.hasOwnProperty("count"))switch(b.count){case 0:a+=".none";break;case 1:a+=".one";break;default:a+=".other"}return this.interpolator().render(this.lookup(a,b.language),{locals:b})},lookup:function(a,b){var c,d,e,f,g;b==null&&(b=this.defaultLanguage),d=a.split("."),e=this.store()[b];try{for(f=0,g=d.length;f<g;f++)c=d[f],e=e[c]}catch(h){e=null}if(e==null)throw new Error("Translation doesn't exist for '"+a+"'");return e},store:function(){return this._store||(this._store={})},interpolator:function(){return this._interpolator||(this._interpolator=new(require("shift").Mustache))}},Metro.Support.I18n.t=Metro.Support.I18n.translate,Metro.Support.Number={isInt:function(a){return a===+a&&a===(a|0)},isFloat:function(a){return a===+a&&a!==(a|0)}},a=["included","extended","prototype","ClassMethods","InstanceMethods"],Metro.Support.Object={extend:function(b){var d,e,f,g,h,i;d=Metro.Support.Array.args(arguments,1);for(h=0,i=d.length;h<i;h++){f=d[h];for(e in f)g=f[e],c.call(a,e)<0&&(b[e]=g)}return b},cloneHash:function(a){var b,c,d;c={};for(b in a)d=a[b],this.isArray(d)?c[b]=this.cloneArray(d):this.isHash(d)?c[b]=this.cloneHash(d):c[b]=d;return c},cloneArray:function(a){var b,c,d,e;d=a.concat();for(b=0,e=d.length;b<e;b++)c=d[b],this.isArray(c)?d[b]=this.cloneArray(c):this.isHash(c)&&(d[b]=this.cloneHash(c));return d},deepMerge:function(b){var d,e,f,g,h,i;d=Metro.Support.Array.args(arguments,1);for(h=0,i=d.length;h<i;h++){f=d[h];for(e in f)g=f[e],c.call(a,e)<0&&(typeof g=="object"&&b[e]?b[e]=Metro.Support.Object.deepMerge(b[e],g):b[e]=g)}return b},defineProperty:function(a,b,c){return c==null&&(c={}),Object.defineProperty(a,b,c)},functionName:function(a){var b;return a.__name__?a.__name__:a.name?a.name:(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},alias:function(a,b,c){return a[b]=a[c]},accessor:function(a,b,c){return a._accessors||(a._accessors=[]),a._accessors.push(b),this.getter(b,a,c),this.setter(b,a),this},setter:function(a,b){return a.hasOwnProperty("_setAttribute")||this.defineProperty(a,"_setAttribute",{enumerable:!1,configurable:!0,value:function(a,b){return this["_"+a]=b}}),a._setters||(a._setters=[]),a._setters.push(b),this.defineProperty(a,b,{enumerable:!0,configurable:!0,set:function(a){return this._setAttribute(b,a)}}),this},getter:function(a,b,c){return a.hasOwnProperty("_getAttribute")||this.defineProperty(a,"_getAttribute",{enumerable:!1,configurable:!0,value:function(a){return this["_"+a]}}),a._getters||(a._getters=[]),a._getters.push(b),this.defineProperty(a,b,{enumerable:!0,configurable:!0,get:function(){return this._getAttribute(b)||(c?this["_"+b]=c.apply(this):void 0)}}),this},variables:function(a){},accessors:function(a){},methods:function(a){var b,c,d;c=[];for(b in a)d=a[b],this.isFunction(d)&&c.push(b);return c},delegate:function(){var a,b,c,e,f,g,h,i,j;e=arguments[0],c=3<=arguments.length?d.call(arguments,1,h=arguments.length-1):(h=1,[]),f=arguments[h++],f==null&&(f={}),g=f.to,a=this.isFunction(e);for(i=0,j=c.length;i<j;i++)b=c[i],a?e[b]=function(){var a;return(a=this[g]())[b].apply(a,arguments)}:this.defineProperty(e,b,{enumerable:!0,configurable:!0,get:function(){return this[g]()[b]}});return e},isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},toArray:function(a){return this.isArray(a)?a:[a]},keys:function(a){return Object.keys(a)},isA:function(a,b){},isRegExp:function(a){return!(!(a&&a.test&&a.exec)||!a.ignoreCase&&a.ignoreCase!==!1)},isHash:function(a){return this.isObject(a)&&!this.isFunction(a)&&!this.isArray(a)},isArray:Array.isArray||function(a){return toString.call(a)==="[object Array]"},kind:function(a){return typeof a!="object"?typeof a:a===null?"null":a.constructor===(new Array).constructor?"array":a.constructor===(new Date).constructor?"date":a.constructor===(new RegExp).constructor?"regex":"object"},isObject:function(a){return a===Object(a)},isPresent:function(a){return!this.isBlank(a)},isBlank:function(a){var b,c;for(b in a)return c=a[b],!1;return!0},has:function(a,b){return a.hasOwnProperty(b)}},Metro.Support.RegExp={regexpEscape:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},Metro.Support.String={camelize_rx:/(?:^|_|\-)(.)/g,capitalize_rx:/(^|\s)([a-z])/g,underscore_rx1:/([A-Z]+)([A-Z][a-z])/g,underscore_rx2:/([a-z\d])([A-Z])/g,constantize:function(a,b){return b==null&&(b=global),b[this.camelize(a)]},camelize:function(a,b){return a=a.replace(this.camelize_rx,function(a,b){return b.toUpperCase()}),b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(this.underscore_rx1,"$1_$2").replace(this.underscore_rx2,"$1_$2").replace("-","_").toLowerCase()},singularize:function(a){var b;return b=a.length,a.substr(b-3)==="ies"?a.substr(0,b-3)+"y":a.substr(b-1)==="s"?a.substr(0,b-1):a},pluralize:function(a,b){var c,d;if(b){if(a===1)return b}else b=a;return d=b.length,c=b.substr(d-1),c==="y"?""+b.substr(0,d-1)+"ies":c==="s"?b:""+b+"s"},capitalize:function(a){return a.replace(this.capitalize_rx,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d}}})).call(this)